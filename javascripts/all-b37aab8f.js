function HBBlogPartsInit(){var t=function(){if(HBBlogParts.debug){var t=new Ten.Logger;t.info.call(t,Array.prototype.slice.call(arguments,0,arguments.length))}};t("Start INIT"),HBBlogParts._starOriginalyLoaded?t("HatenStar.js is originaly loaded"):Hatena.Star.EntryLoader.loadEntries=function(){},HBBlogParts.Star={starEntries:[],showEntries:function(){HBBlogParts.Star.addEntries(HBBlogParts.Star.starEntries),HBBlogParts.Star.starEntries=[]},addStarElement:function(t,e){t.comment_container=Hatena.Star.EntryLoader.createCommentContainer(),t.star_container=Hatena.Star.EntryLoader.createStarContainer(),t.comment_container.style.display="none",e.appendChild(t.comment_container),e.appendChild(t.star_container)},createStarEntry:function(t,e){var a={};a.uri=t.permalink;for(var r="",n=t.tags,o=0;o<n.length;o++)r+="["+n[o]+"]";var s=t.comment;return s&&(r+=s),r||(r=t.user+"のブックマーク"),a.title=r,HBBlogParts.Star.addStarElement(a,e),a},addEntries:function(t){var e=Hatena.Star.EntryLoader,a=e.entries;if(e.entries=null,e.entries=[],t&&"number"==typeof t.length)for(var r=0;r<t.length;r++){var n=new Hatena.Star.Entry(t[r]);n.showButtons(),e.entries.push(n)}e.getStarEntries(),a&&(e.entries.push(a),e.entries=Ten.Array.flatten(e.entries))}},HBBlogParts.Bookmark=new Ten.Class({initialize:function(t,e,a,r,n){this.eid=t,this.user=e,this.comment=a,this.tags=r,this.timestamp=n}},{baseURL:"http://b.hatena.ne.jp/",toDOMElements:function(){var t=HBBlogParts.formatDate(this.timestamp,""),e=this.baseURL+this.user+"/"+t+"#bookmark-"+this.eid;this.permalink=e,this.itemNode=Ten.Element("li",{className:"hatena-bookmark-item"});for(var a="http://cdn.www.st-hatena.com/users/"+this.user.substr(0,2)+"/"+this.user+"/profile.gif",r=Ten.Element("img",{width:"64",height:"64",title:this.user,alt:this.user,className:"hatena-bookmark-profile-image",src:a}),n=Ten.Element("span",{className:"hatena-bookmark-tags"}),o=0;o<this.tags.length;o++){var s=this.baseURL+this.user+"/"+this.tags[o]+"/",i=Ten.Element("li",{className:"label light"}),l=Ten.Element("a",{href:s,className:"hatena-bookmark-user-tag"},this.tags[o]);i.appendChild(l),n.appendChild(i)}var m=Ten.Element("span",{className:"hatena-bookmark-user-info"});m.appendChild(r),m.appendChild(Ten.Element("a",{href:e,className:"hatena-bookmark-username"},this.user)),m.appendChild(n),this.userInfoNode=m,this.tagsNode=n,this.commentNode=Ten.Element("span",{className:"hatena-bookmark-comment"},this.comment),this.dateNode=Ten.Element("span",{className:"hatena-bookmark-timestamp"},HBBlogParts.formatDate(this.timestamp,"/")),this.starNode=Ten.Element("span",{className:"hatena-bookmark-star"}),0==this.comment.length&&(Ten.DOM.addClassName(this.itemNode,"nocomment"),this.nocomment=!0),this.itemNode.manipulator=this},_alredyConstructed:!1,construct:function(){if(this._alredyConstructed)return!0;for(var t=this.design,e=0;e<t.length;e++){var a=t[e].toLowerCase();"u"!=a?"t"!=a?"c"!=a?"d"!=a?"s"!=a||this.itemNode.appendChild(this.starNode):this.itemNode.appendChild(this.dateNode):this.itemNode.appendChild(this.commentNode):this.itemNode.appendChild(this.tagsNode):this.itemNode.appendChild(this.userInfoNode)}this._alredyConstructed=!0},_alreadyShown:!1,show:function(t){if("undefined"==typeof t&&(t=this,HBBlogParts.Bookmark.showCount++,HBBlogParts.Bookmark.showCount>HBBlogParts.Bookmark.delayStart&&!t._alreadyShown)){var e=Math.floor(HBBlogParts.Bookmark.showCount/HBBlogParts.Bookmark.delayStart)+1;return window.setTimeout(t.show,200*e,t),void 0}t._alreadsyShown||(t.addStar(),t.construct(),t._alreadyShown=!0,HBBlogParts.Bookmark.showCount--),t.itemNode.style.display="block",t.hidden=!1},hide:function(){this.itemNode.style.display="none",this.hidden=!0},setOverlimit:function(){Ten.DOM.addClassName(this.itemNode,"hatena-bookmark-overlimit"),this.overlimit=!0},unsetOverlimit:function(){Ten.DOM.removeClassName(this.itemNode,"hatena-bookmark-overlimit"),this.overlimit=!1},_alreadyAddStar:!1,addStar:function(){if(this._alreadyAddStar)return!0;var t=HBBlogParts.Star.createStarEntry(this,this.starNode);HBBlogParts.Star.starEntries.push(t),this._alreadyAddStar=!0},toHTML:function(t){return t||(t=["u","t","c","d","s"]),this.toDOMElements(),this.design=t,this.itemNode}}),HBBlogParts.Bookmark.showCount=0,HBBlogParts.Bookmark.delayStart=10,HBBlogParts.commentStartNodes={},HBBlogParts.BookmarkEntry=new Ten.Class({initialize:function(t){this.entry=t,this.baseURL="http://b.hatena.ne.jp/entry/",this.entryPage=this.baseURL+this.entry.url.replace(/http(s)?:\/\//,"").replace(/#/,"%23"),this.bExMark=this.getBExMark(),this.users=this.getUsers(),this.commentButton=this.getCommentButton()}},{_appendURL:"http://b.hatena.ne.jp/my/add.confirm?url=",getAppendURL:function(){return this._appendURL+encodeURIComponent(this.entry.url)},getCommentButton:function(){this.getAppendURL();var t=Ten.Element("div",{id:"bookmark-comment-add"},Ten.Element("a",{href:this.appendURL},Ten.Element("span",{href:this.appendURL},"はてなブックマークでコメントする")));return t},getBExMark:function(){var t=this.getAppendURL(),e=Ten.Element("span",{className:"hatena-bookmark-b-ex-mark"},Ten.Element("a",{href:t},Ten.Element("img",{title:"このエントリーをはてなブックマークに追加",alt:"このエントリーをはてなブックマークに追加",src:"http://b.st-hatena.com/images/append.gif"})));return e},getUsers:function(){var t=this.entry.bookmarks.length,e=this.entry.count-t,a=Ten.Element("span",{className:"hatena-bookmark-users"},"("+t+" + "+e+")");return a}}),HBBlogParts.addBookmarkNode=new Ten.Class({initialize:function(t){this.entryObj=t;var e=t.entry;this.url=e.url,this.screenshot=e.screenshot,this.image=e.image,this.appendURL="http://b.hatena.ne.jp/my/add.confirm?url="+encodeURIComponent(this.url)}},{toHTML:function(){var t=Ten.Element("li",{className:"hatena-bookmark-item hatena-bookmark-addcomment-container"},Ten.Element("div",{className:"hatena-bookmark-addcomment small btn icon-left info metro rounded icon-vkontakte"},Ten.Element("a",{href:this.appendURL},"はてなブックマークでコメントする")));return t}}),HBBlogParts.EmptyBookmarkContainer=new Ten.Class({initialize:function(t){this.permalink=t.url,this.container=Ten.Element("ul",{id:"hatena-bookmark-list-container"}),this.wrapper=Ten.Element("div",{className:"hatena-bookmark-container",id:"hatena-bookmark-container"}),this.appendURL="http://b.hatena.ne.jp/my/add.confirm?url="+encodeURIComponent(this.permalink);var e=new HBBlogParts.BookmarkEntry(t);this.entryObj=e,this.title=Ten.Element("div",{className:"hatena-bookmark-title"},Ten.Element("div",{className:"hatena-bookmark-entry-navigator"},Ten.Element("div",{className:"hatena-bookmark-comment-header"},Ten.Element("a",{href:this.appendURL},"はてなブックマークでのコメント")))),this.footer=Ten.Element("div",{className:"hatena-bookmark-footer"}),this.entry=t}},{toHTML:function(){this.entry;var t=new HBBlogParts.addBookmarkNode(this.entryObj);return this.container.appendChild(t.toHTML()),this.container.appendChild(Ten.Element("li",{className:"hatena-bookmark-item"},"まだこの記事のブックマークはありません。")),this.wrapper.appendChild(this.title),this.wrapper.appendChild(this.container),this.wrapper.appendChild(this.footer),this.wrapper}}),HBBlogParts.BookmarkContainer=new Ten.Class({initialize:function(t){this.permalink=t.url,this.container=Ten.Element("ul",{id:"hatena-bookmark-list-container"}),this.wrapper=Ten.Element("div",{className:"hatena-bookmark-container",id:"hatena-bookmark-container"}),this.showAllMessage="すべてのコメントを表示する",this.hideAllMessage="元に戻す";var e=Ten.Element("span",{className:"hatena-bookmark-span-button"},this.showAllMessage);e.insertBefore(Ten.Element("i",{className:"icon-plus-squared"}),e.childNodes[0]),this.showAllObserver=new Ten.Observer(e,"onclick",this,"toggleOverlimit");var a=new HBBlogParts.BookmarkEntry(t);this.entryObj=a,this.entryPageLink=Ten.Element("a",{className:"hatena-bookmark-comment-show",href:a.entryPage},"はてなブックマークで読む"),this.title=Ten.Element("div",{className:"hatena-bookmark-title"},Ten.Element("div",{className:"hatena-bookmark-entry-navigator"},Ten.Element("div",{className:"hatena-bookmark-comment-header"},Ten.Element("a",{href:a.entryPage},"はてなブックマークでのコメント "),a.users," "))),this.footer=Ten.Element("div",{className:"hatena-bookmark-footer"}),this.showAllLink=Ten.Element("div",{className:"hatena-bookmark-showall-comment small btn info metro rounded"},e),this.footer.appendChild(this.showAllLink),this.footer.appendChild(Ten.Element("div",{className:"hatena-bookmark-entrypage-link small btn icon-left info metro rounded icon-vkontakte"},this.entryPageLink)),this.entry=t,this.commentLimit=4,this.allowOverlimitComment=!1,this.bookmarks=[]}},{toHTML:function(t){for(var e=this.entry,a=e.bookmarks,r=0,n=[],o=0;o<a.length;o++){var s=a[o],i=new HBBlogParts.Bookmark(e.eid,s.user,s.comment,s.tags,s.timestamp);i.toHTML(t),i.nocomment?(i.hide(),i.setOverlimit()):r>=this.commentLimit?(i.hide(),i.setOverlimit()):(i.show(),r++),n.push(i)}var l=this.commentLimit-r;if(l>0)for(var o=0;o<n.length&&!(0>=l);o++)n[o].nocomment&&(n[o].show(),n[o].unsetOverlimit(),r++,l--);var m=new HBBlogParts.addBookmarkNode(this.entryObj);this.container.appendChild(m.toHTML());for(var o=0;o<n.length;o++){var i=n[o];this.bookmarks.push(i),this.container.appendChild(i.itemNode)}return n.length<=this.commentLimit&&(this.showAllLink.style.display="none"),this.changeLinkMessage(r),this.commentCount=r,this.wrapper.appendChild(this.title),this.wrapper.appendChild(this.container),this.wrapper.appendChild(this.footer),HBBlogParts.Star.showEntries(),this.wrapper},changeLinkMessage:function(t){this.entry.bookmarks.length-t,this.entryPageLink.style.display="inline",this.entryPageLink.innerHTML="はてなブックマークで確認"},showOverlimitUser:function(){for(var t=0;t<this.bookmarks.length;t++){var e=this.bookmarks[t];e.overlimit&&e.show()}HBBlogParts.Star.showEntries(),this.changeLinkMessage(this.bookmarks.length),this.allowOverlimitComment=!0},hideOverlimitUser:function(){for(var t=0;t<this.bookmarks.length;t++){var e=this.bookmarks[t];e.overlimit&&e.hide()}this.changeLinkMessage(this.commentCount),this.allowOverlimitComment=!1},toggleOverlimit:function(t){this.allowOverlimitComment?(this.hideOverlimitUser(),Ten.DOM.addClassName(t.target,"hatena-bookmark-show-overlimit"),Ten.DOM.removeClassName(t.target,"hatena-bookmark-hide-overlimit"),t.target.innerHTML=this.showAllMessage):(this.showOverlimitUser(),Ten.DOM.removeClassName(t.target,"hatena-bookmark-show-overlimit"),Ten.DOM.addClassName(t.target,"hatena-bookmark-hide-overlimit"),t.target.innerHTML=this.hideAllMessage)}}),HBBlogParts.A={},HBBlogParts.A.reduce=Array.reduce||function(t,e){var a=2,r=t.length;if("function"!=typeof e)throw TypeError("A.reduce: not a function ");var n=0;if(arguments.length>a)var o=arguments[a++];else for(;;){if(n in t){o=t[n++];break}if(++n>=r)throw new TypeError("A.reduce: empty array")}for(;r>n;n++)n in t&&(o=e.call(null,o,t[n],n,t));return o},HBBlogParts.DOM={},HBBlogParts.DOM.ancestors=function(t){for(var e=t.ownerDocument.body,a=[],r=t;r!=e;)a.push(r),r=r.parentNode;return a.push(e),a},HBBlogParts.DOM.commonAncestor=function(t,e){for(var a=HBBlogParts.DOM.ancestors(t).reverse(),r=HBBlogParts.DOM.ancestors(e).reverse(),n=null,o=0;a[o]&&r[o]&&a[o]==r[o];o++)n=a[o];return n},HBBlogParts.NearestCommonAncestor=function(e){return t("NCA arguments",e),e.length<2?e[0]:HBBlogParts.A.reduce(e,function(t,e){return HBBlogParts.DOM.commonAncestor(t,e)})},HBBlogParts.DOM.firstNonCommonAncestor=function(t,e){for(var a=HBBlogParts.DOM.ancestors(t),r=null,n=0;a[n]&&a[n]!=e;n++)r=a[n];return r},HBBlogParts.DOM.isDescendent=function(t,e){for(var a=HBBlogParts.DOM.ancestors(e),r=0;r<a.length;r++)if(a[r]==t)return!0;return!1},HBBlogParts.applyCSS=function(t){var e=document.getElementsByTagName("head")[0],a="http://b.hatena.ne.jp/css/blogparts/"+t+".css";HBBlogParts.debug&&(a+="?"+(new Date-0));var r=Ten.Element("link",{rel:"stylesheet",type:"text/css",href:a});e.appendChild(r)},HBBlogParts.formatDate=function(t,e){var a=new Date(t),r=a.getFullYear().toString(10),n=(a.getMonth()+1).toString(10),o=a.getDate().toString(10);return 10>n&&(n="0"+n),10>o&&(o="0"+o),[r,n,o].join(e)},HBBlogParts.useCanonicalizedURI=!0,HBBlogParts.canonicalizedURI=function(t){return HBBlogParts.useCanonicalizedURI?t.replace(/#.*$/,""):t},HBBlogParts.absolutePath=function(t){var e=document.createElement("a");return e.setAttribute("href",t),e.cloneNode(!1).href},HBBlogParts.catchJSON=function(e){if(e){var a=new HBBlogParts.BookmarkContainer(e);a.commentLimit=HBBlogParts.isPermalinkPage()?HBBlogParts.permalinkCommentLimit:HBBlogParts.listPageCommentLimit;var r=e.url;HBBlogParts.insert(a.toHTML(HBBlogParts.Design),r),HBBlogParts.setStyles(),HBBlogParts.shownPermalinks[r]=1}else t("No Bookmarks");HBBlogParts.catchCount++,t("[EntryNum, EntryTotal]",HBBlogParts.catchCount,HBBlogParts.Entries.length),HBBlogParts.catchCount>=HBBlogParts.Entries.length&&HBBlogParts.showEmptyEntries()},HBBlogParts.insert=function(e,a){var r=HBBlogParts.commentStartNodes[a];if(r){var n=r.parentNode;if(t("[InsertObject, InsertTarget]",[e,r]),!n)return t("notfound parent"),void 0;HBBlogParts.insertPosition&&"after"==HBBlogParts.insertPosition.toLowerCase()&&(r=r.nextSibling),n.insertBefore(e,r)}},HBBlogParts._alreadyStylesSet=!1,HBBlogParts.setStyles=function(){HBBlogParts.useUserCSS||HBBlogParts._alreadyStylesSet||(HBBlogParts.applyCSS(HBBlogParts.cssName),HBBlogParts._alreadyStylesSet=!0)},HBBlogParts.showEmptyEntries=function(){for(var e=0;e<HBBlogParts.Entries.length;e++){var a=HBBlogParts.Entries[e];if(!HBBlogParts.shownPermalinks[a]){t("This url has no bookmarks",a);var r={url:a,bookmarks:[]},n=new HBBlogParts.EmptyBookmarkContainer(r);HBBlogParts.insert(n.toHTML(),a),HBBlogParts.setStyles()}}},HBBlogParts.showBookmarkComment=function(t){var e="http://b.hatena.ne.jp/entry/jsonlite/?",a=e+"url="+encodeURIComponent(t)+"&callback=HBBlogParts.catchJSON",r=Ten.Element("script",{src:a,type:"text/javascript"});document.body.appendChild(r)},HBBlogParts.getPermaLinks=function(e,a){var r=[];"string"==typeof e&&(e=[e]);for(var n=0;n<e.length;n++)if(r=Ten.querySelectorAll(e[n]),r.length>0){t("[currentSelector, gotElements(nonFiltered)]",e[n],r);for(var o=[],s=[],i={},l={},m=0;m<r.length;m++){if("textNode"==a)var h=r[m].firstChild.nodeValue;else var h=r[m].getAttribute(a);HBBlogParts.useCanonicalizedURI&&(h=HBBlogParts.canonicalizedURI(h)),h=HBBlogParts.absolutePath(h),HBBlogParts.permalinkPathRegexp.test(h)&&!i[h]&&h.indexOf("b.hatena.ne.jp")<0&&h.indexOf("http://",6)<0&&(o.push(h),s.push(r[m]),i[h]=1)}if(t("[currentSelector, gotElements(filtered)]",e[n],o),0==o.length)continue;if(1==o.length)return l[o[0]]=null,{entries:o,criterions:l};for(var B=HBBlogParts.NearestCommonAncestor(s),n=0;n<s.length;n++){var d=HBBlogParts.DOM.firstNonCommonAncestor(s[n],B);d.criterionCount=0,l[o[n]]=d}return t("Insertion Criterions",l),{entries:o,criterions:l}}var o=[],l={};return{entries:o,criterions:l}},HBBlogParts.isPermalinkPage=function(){var t=HBBlogParts.canonicalizedURI(location.pathname);return HBBlogParts.permalinkPathRegexp&&HBBlogParts.permalinkPathRegexp.test(t)?!0:!1},HBBlogParts.getTargets=function(e,a){var r={},n=Ten.querySelectorAll(e);for(url in a){var o=a[url];o&&(o.criterionCount=0)}for(url in a)if(t("ALREADY",HBBlogParts._alreadyShown[url]),!HBBlogParts._alreadyShown[url]){var o=a[url];o&&o.criterionCount++;for(var s=0,i=0;i<n.length;i++){var l=n[i];if(null==o)r[url]=l;else if(HBBlogParts.DOM.isDescendent(o,l)&&(r[url]=l,s++,o&&o.criterionCount==s))break}}return r},HBBlogParts.start=function(){t("Now Searching Permalinks");var e=[],a={};if(HBBlogParts.isPermalinkPage()&&!HBBlogParts.isHatenaService)t("This page is Permalink PAGE"),e=HBBlogParts.permalinkURI?[HBBlogParts.permalinkURI]:[HBBlogParts.canonicalizedURI(location.href)],a[e[0]]=null;else{t("This page is LIST PAGE"),t(HBBlogParts.permalinkSelector,HBBlogParts.permalinkAttribute);var r=HBBlogParts.getPermaLinks(HBBlogParts.permalinkSelector,HBBlogParts.permalinkAttribute);e=r.entries,a=r.criterions}t("Got Entries",e),HBBlogParts.Entries=e;var n=HBBlogParts.commentInsertSelector;if(HBBlogParts.isPermalinkPage()&&HBBlogParts.permalinkCommentInsertSelector)var n=HBBlogParts.permalinkCommentInsertSelector;if(t("Insertion Selector",n),t("Insertion Criterions",a),"string"==typeof n)var o=HBBlogParts.getTargets(n,a);else for(var s=0;s<n.length;s++){var o=HBBlogParts.getTargets(n[s],a),i=0;for(url in o)i++;if(i>0){t("[Insertsion selector, targets]",n[s],o);break}}for(var s=0;s<e.length;s++)HBBlogParts._alreadyShown[e[s]]||(HBBlogParts._alreadyShown[e[s]]=1,t([e[s],o[e[s]]]),HBBlogParts.commentStartNodes=o,HBBlogParts.showBookmarkComment(e[s]))},HBBlogParts.register=function(){t(Ten.DOM.loaded),Ten.DOM.loaded?(t("DOM Content is Loaded!"),HBBlogParts.start()):(t("DOM Content is not loaded!"),Ten.DOM.addEventListener("onload",HBBlogParts.start))};var e=new RegExp("^https?://[^/]+.hatena.ne.jp/([^/]+)/");if(e.test(location.href)){var a=e.exec(location.href)[1]||"";HBBlogParts.isHatenaService=!0,location.href.indexOf("g.hatena.ne.jp")>0?HBBlogParts.commentInsertSelector="div.section":(HBBlogParts.permalinkCommentInsertSelector=["div.comment","div.section"],HBBlogParts.commentInsertSelector="div.section"),HBBlogParts.insertPosition="after",HBBlogParts.permalinkSelector="div.section h3 a",HBBlogParts.permalinkAttribute="href",HBBlogParts.permalinkPathRegexp=new RegExp(a+"/\\d{8}"),HBBlogParts.useCanonicalizedURI=!1,HBBlogParts.listPageCommentLimit=3,HBBlogParts.permalinkCommentLimit=9999}"undefined"==typeof HBBlogPartsFromBookmarklet?HBBlogParts.register():t("From Bookmark let")}if("undefined"==typeof HBBlogParts){var HBBlogParts={};HBBlogParts._alreadyShown={},HBBlogParts.shownPermalinks={},HBBlogParts.catchCount=0,HBBlogParts.commentInsertSelector=["div.hatena_bookmark_comments"],HBBlogParts.permalinkSelector=["div.hatena_bookmark_comments"],HBBlogParts.permalinkAttribute="data-uri",HBBlogParts.permalinkPathRegexp=/\/.+\.html$/,HBBlogParts.permalinkURI=window.location.href.replace(":"+window.location.port,""),HBBlogParts.insertPosition="after",HBBlogParts.useUserCSS=!0,HBBlogParts.permalinkCommentLimit=30,HBBlogParts.Design=["u","d","t","c","s"]}HBBlogParts.jsLoader=function(t,e,a){var r=new Date-0;"function"!=typeof a&&(a=function(t){window.console&&console.error("jsloader load error: "+t)});var n=function(o){var s=document.createElement("script");s.type="text/javascript",s.charset="utf-8";var i;if(t.length){var l=t.shift();i=function(){n(l)}}else i=e;window.ActiveXObject?s.onreadystatechange=function(){("complete"==s.readyState||"loaded"==s.readyState)&&i()}:(s.onload=i,s.onerror=function(){a(o)}),s.src=o+"?"+r;var m=document.getElementsByTagName("head")[0];m.appendChild(s)};n(t.shift())},"undefined"==typeof Hatena||"undefined"==typeof Hatena.Star?HBBlogParts.jsLoader(["http://s.hatena.ne.jp/js/HatenaStar.js"],HBBlogPartsInit):(HBBlogParts._starOriginalyLoaded=!0,HBBlogPartsInit());