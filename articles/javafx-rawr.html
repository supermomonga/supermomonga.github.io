<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>RubyでGUIアプリを作るならJRuby+JavaFX+Rawrで決まり！ - かなりすごいブログ</title><link href="/stylesheets/theme-22018243.css" media=screen rel=stylesheet /> <link href="/stylesheets/monokai-a37e9352.css" media=screen rel=stylesheet /> </head> <body role=main> <header> <h1> <a href="/">かなりすごいブログ</a> </h1> </header> <div id=main><div class=entry> <div class=entry-header> <h1> RubyでGUIアプリを作るならJRuby+JavaFX+Rawrで決まり！ </h1> <div class=entry-tags> </div> </div> <div class=entry-share> <div class="share hatena"> <a href="//b.hatena.ne.jp/entry/" class=hatena-bookmark-button data-hatena-bookmark-layout=vertical-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"></a> <script src="//b.st-hatena.com/js/bookmark_button.js" charset=utf-8 async=async></script> </div> <div class="share twitter"> <a href="https://twitter.com/share" class=twitter-share-button data-count=vertical data-via=supermomonga data-lang=ja data-dnt=true>ツイート</a> </div> <div class="share facebook"> <div class=fb-like data-layout=box_count data-action=like data-show-faces=false data-share=false></div> </div> <div class="share pocket"> <a data-pocket-label=pocket data-pocket-count=vertical class=pocket-btn data-lang=en></a> </div> </div> <div class=entry-body><p>Ruby大好きな私としては、一般配布するGUIアプリケーションとかもRubyで書きたい訳です。しかし、Windowsには標準でRubyは入っていないし、Macもバージョンが古い1.8.7が標準だしで、普段プログラミングなんかしない一般ユーザーさんでも簡単に起動できるアプリケーションを作るのがなかなか難しいという問題があります。</p> <p>そういった問題から、クロスプラットフォームな言語・ライブラリ、例えばC++のQtなんかに一時期浮気したりもしたのですが、やっぱりRubyで書きたい。だってRubyが好きだから。</p> <p>そして、色々調べまくった結果、はい、ついに「これだ！」と思えるRubyによるGUIアプリケーション開発環境を揃えることができました。それは…</p> <ul> <li> JRuby</li> <li> JavaFX</li> <li> jrubyfx</li> <li> Rawr</li> </ul> <p>この組み合わせです…！それぞれ解説していきましょう。</p> <h2 id=toc_0>JRuby … JavaでRuby！</h2> <ul> <li> <a href="//jruby.org/">JRuby公式サイト</a></li> </ul> <p>JRubyは、簡単に言えばJVMで動くRubyです。つまり、Javaがインストールされている環境で普通に動きます。<del>Windowsには標準でJavaが入っている</del> <em>（8月11日追記：そんなことはありませんでした＞＜）</em> ので、JRubyで作成したアプリケーションをjarファイルとしてパッケージングし配布すれば、ユーザーさんはそのjarファイルをダブルクリックするだけでアプリケーションが使えてしまうという訳です。</p> <p>JRuby自体の完成度も高く、プリミティブ型へのキャストなどで若干罠はあるものの、概ねJavaの顔が覗かせることなく素のRubyと同じ様にプログラミング可能です。またなんといっても、Ruby on Railsアプリケーションのコードに一切変更を加えることなく動かせるという事を目標に開発されているくらい、互換性が高いです。時代はJRuby。</p> <h2 id=toc_1>JavaFX … なんかいいかんじにGUI！</h2> <p>GUI。GUIをやりたいんです。swingとかawtとかSWTとか色々ありますが、私はJavaFXを推します。JavaFX、色々すごいのですが、なによりWebViewが使えるのです！専用ブラウザとかを作ることが多い私にとって、これはすごく大きい。ただし、FlashPlayerなどのプラグインに対応していないので、その点だけが残念です。</p> <p><img alt="JRuby+JavaFXサンプル" src="/images/uploads/2013-08-gcj7711v2kuh-2ffd2dbe.png"/></p> <p>JavaFXは、最新のJDKをインストールすれば標準で付いてきます。</p> <ul> <li> <a href="//www.oracle.com/technetwork/jp/java/javafx/overview/index.html">JDK</a></li> </ul> <h2 id=toc_2>jrubyfx … JavaFXをRubyishに！</h2> <p><a href="https://github.com/jruby/jrubyfx">jrubyfx</a>は、JavaFXをJRubyからRubyishに書けるようにするためのラッパーライブラリです。なので、これを使用せずともJavaFXなJRubyアプリケーションを書くこと自体は可能ですが、jrubyfxを導入することによって、かなりRubyishにGUIアプリケーションを作成することができるようになります。</p> <pre lang=ruby>require 'java'
require 'jrubyfx'

class App &lt; JRubyFX::Application
  def start(stage)
    with(stage, width: 800, height: 600, title: 'Hello JRubyFX') do
      layout_scene do
        web_view do |v|
          v.engine.load "http://google.com/"
        end
      end
      show
    end
  end
end

App.launch

</pre> <p>たったこれだけのコードで、上記スクリーンショットの様な簡易ブラウザが完成してしまいます。すごいよjrubyfx。</p> <h2 id=toc_3>Rawr … 配布用にパッケージング！</h2> <ul> <li> <a href="//rawr.rubyforge.org/">Rawr</a></li> </ul> <p>Rawrを使えば、作成したjrubyアプリケーションを簡単にjarへとパッケージングすることができます。Rawrのすごいところはそれだけでなく、なんとWindowsやMac OS Xのアプリケーション形式、つまり.exeや.appといったファイルとしてラッピングもできるのです。一般のPCユーザーは「アプリケーション＝.exe形式」という認識でしょうし、「.jar？なにそれ？」という方が殆どでしょう。.exe形式で配布できるのはとてもうれしいですね。しかも、.exeファイルをコンパイルしているわけではないので（実は設定ファイルを読み込んでjarを実行するexeファイルを配置してくれているだけ）、Mac OS Xで.exeパッケージを作成することができます。マカーだけどWindowsユーザーも使えるアプリケーションを作りたい、といった場合に便利ですね。まさに私がそのパターンです。</p> <h2 id=toc_4>実際に作ってみよう</h2> <p>というわけで、JRuby+JavaFX+jrubyfx+Rawrが最強！というご紹介でした。それでは実際にサンプルのブラウザアプリケーションを作ってみましょう。</p> <h3 id=toc_5>JRubyのインストール</h3> <p>まずJRubyが入ってない人はインストールします、Mac OS Xなら</p> <p><code>brew install jruby</code></p> <p>で一発です。簡単ですね。</p> <p>Windowsの場合も簡単です。まずWindowsPCを友人に譲り、その後MacBook Airを購入し、<a href="//brew.sh/index_ja.html">homebrew</a>を導入することで上記コマンドでインストールできるようになります。</p> <h3 id=toc_6>JDKのインストール</h3> <p><a href="//www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html">オラクルのサイト</a>からJDK7をダウンロードし、インストールしましょう。</p> <h3 id=toc_7>jrubyfxのインストール</h3> <p>jrubyfxはrubygemですので、以下のコマンドでインストールできます。</p> <p><code>jruby -S gem install jrubyfx</code></p> <h3 id=toc_8>Rawrのインストール</h3> <p>同様に、Rawrもインストールしましょう。Rawrはソース元を指定する必要があります。</p> <p><code>jruby -S gem install rawr --source http://gems.neurogami.com</code></p> <h3 id=toc_9>Rawrプロジェクトの作成</h3> <p>これで準備は整いました。それでは、Rawrプロジェクトを作成していきましょう。まずはプロジェクト用にフォルダを作成します。ここでは<code>simple_browser</code>とします。その後、<code>simple_browser</code>フォルダに移動します。</p> <p><code>mkdir simple_browser</code></p> <p><code>cd ./simple_browser</code></p> <p>rawrコマンドでrawrプロジェクトのセットアップを行います。これで、必要なファイル一式がrawrによって自動で配置されます。</p> <p><code>jruby -S rawr install</code></p> <h3 id=toc_10>依存gemの追加と設定</h3> <p>次に、依存gemの設定を行います。残念ながらRawrはGemfileなどを考慮してくれませんので、自分でgemのファイルを配置する必要があります。<code>./lib/ruby</code>フォルダを作成し、そちらにインストールしましょう。</p> <p><code>mkdir ./lib/ruby</code></p> <p><code>jruby -S gem install -i ./lib/ruby jrubyfx jrubyfx-fxmlloader --no-rdoc --no-ri</code></p> <p>その後、パッケージング時に<code>./lib/ruby</code>の各ファイルを読みこんでくれるように、設定ファイルを編集します。おもむろにVimを起動し、<code>./build_configuration.rb</code>を編集しましょう。20〜30行目付近にあるコメントを参考に、<code>c.source_dirs</code>に&#8221;src&#8221;だけでなく&#8221;lib/ruby&#8221;も追加してみます。</p> <pre lang=ruby># A list of directories where source files reside
# default value: ["src"]
#
c.source_dirs = ["src", "lib/ruby"]
</pre> <p>これでプロジェクトの設定は完了です！</p> <h3 id=toc_11>アプリケーションコードの作成</h3> <p>さて、いよいよアプリケーションのコードを作成します。Vimで<code>./src/main.rb</code>を作成し、以下のコードをペースト・保存してみましょう。</p> <pre lang=ruby>require 'java'
require 'jrubyfx'

class App &lt; JRubyFX::Application
  def start(stage)
    with(stage, width: 800, height: 600, title: 'Hello JRubyFX') do
      layout_scene do
        web_view do |v|
          v.engine.load "http://google.com/"
        end
      end
      show
    end
  end
end

App.launch

</pre> <h3 id=toc_12>パッケージング</h3> <p>最後にパッケージングです。</p> <p><code>jruby -S rake rawr:jar</code></p> <p>を実行すると、ディレクトリ<code>./package/jar</code>と、その中に<code>simple_browser.jar</code>が作成されます。<code>java</code>コマンドで、jarファイルを実行してみましょう。</p> <p><code>java -jar ./package/jar/simple_browser.jar</code></p> <p>無事ブラウザ画面が表示されたら成功です！お疲れ様でした。</p> <h3 id=toc_13>Windows用にパッケージング</h3> <p>さきほどはjarファイルとしてパッケージングしましたが、もちろんexe化も可能です。</p> <p><code>jruby -S rake rawr:bundle:exe</code></p> <p>を実行しましょう。ディレクトリ<code>./package/windows</code>と、その中に<code>simple_browser.exe</code>が作成されます。配布時は、.exeファイルだけでなく、<code>windows</code>フォルダ内のファイルすべてを同梱する必要があります。適当にzipとかに固めて配布しましょう。</p> <p>その他のコマンドやパッケージングコマンドは、<code>jruby -S rake -T</code>コマンドで確認できます。</p> <pre lang=sh>rake rawr:base_jar                  # Create a base jar file
rake rawr:build_extra_jars          # Build all additional user jars
rake rawr:bundle:app                # Bundles the jar from rawr:jar into a native Mac OS X application (.app)
rake rawr:bundle:exe                # Bundles the jar from rawr:jar into a native Windows application (.exe)
rake rawr:clean                     # Removes generated content
rake rawr:compile                   # Compiles all the Java source, Mirah source, and Ruby source files in the source_dirs entry in the build_configuration.rb file
rake rawr:compile_duby_classes      # Compiles the Duby source files specified in the source_dirs entry
rake rawr:compile_java_classes      # Compiles the Java source files specified in the source_dirs entry
rake rawr:compile_mirah_classes     # Compiles the Mirah source files specified in the source_dirs entry
rake rawr:compile_ruby_classes      # Compiles the Ruby source files specified in the source_dirs entry
rake rawr:get:current-jruby         # Fetch the most recent build of  jruby-complete.jar
rake rawr:get:current-stable-jruby  # Fetch the most recent stable jruby-complete.jar
rake rawr:jar                       # Uses compiled output and creates an executable jar file
</pre> <h2 id=toc_14>まとめ</h2> <p>いかがでしたか？みなさんもぜひJRubyを使ってみてください。</p> <p>ちなみにJRuby上達の秘訣は<a href="//minecraft.net/">Minecraftというゲーム</a>にあります。今度、詳細を記事にしたいと思います。</p> </div> <div class=entry-author> <div class=avatar> <img src="/images/kokoro-chan-da2b7132.png"> </div> <div class=profile> <h3> supermomonga </h3> <p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p> <a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a> </div> </div> <div class=entry-meta> <h3> コメント一覧ですよ </h3> <div class=hatena_bookmark_comments data-uri="http://blog.supermomonga.com/articles//javafx-rawr.html"></div> </div> </div> <aside> <h2> タグ一覧ですよ </h2> <ol> <li class="default label"> <i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/java.html">Java</a>(4) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(6) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li> </ol> </aside> </div> <script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-22136268-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script> </body> </html> <div id=fb-root></div> <script src="/javascripts/bookmark_blogparts-90b8ae42.js" async=async defer=defer></script> <script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>