<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>「このVim…しゃべるぞ！」Shaberu.vimをリリースしました - かなりすごいブログ</title><link href="/stylesheets/theme-22018243.css" media=screen rel=stylesheet /> <link href="/stylesheets/monokai-a37e9352.css" media=screen rel=stylesheet /> </head> <body role=main> <header> <h1> <a href="/">かなりすごいブログ</a> </h1> </header> <div id=main><div class=entry> <div class=entry-header> <h1> 「このVim…しゃべるぞ！」Shaberu.vimをリリースしました </h1> <div class=entry-tags> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a> </li> </div> </div> <div class=entry-share> <div class="share hatena"> <a href="//b.hatena.ne.jp/entry/" class=hatena-bookmark-button data-hatena-bookmark-layout=vertical-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"></a> <script src="//b.st-hatena.com/js/bookmark_button.js" charset=utf-8 async=async></script> </div> <div class="share twitter"> <a href="https://twitter.com/share" class=twitter-share-button data-count=vertical data-via=supermomonga data-lang=ja data-dnt=true>ツイート</a> </div> <div class="share facebook"> <div class=fb-like data-href="blog.supermomonga.com/articles/vim/shaberu-vim.html" data-layout=box_count data-action=like data-show-faces=false data-share=false></div> </div> <div class="share pocket"> <a data-pocket-label=pocket data-pocket-count=vertical class=pocket-btn data-lang=en></a> </div> </div> <div class=entry-body><p><a href="//atnd.org/events/33746" target=_blank>Vim Advent Calendar 2012</a> 67日目の記事になります。</p> <p>昨日、66日目の記事は@yomi322さんの「<a href="//yomi322.hateblo.jp/entry/2013/02/04/000316" target=_blank>Vimで突然の死に備える</a>」でした。みなさん備えてますか？</p> <h2 id=toc_0>Shaberu.vimをリリースしました</h2> <p>Vimとおしゃべりできたら素敵だと思いませんか？私は思います。</p> <p>Sho…<a href="//vinarian.blogspot.jp/2013/01/vim-advent-calendar-36-2012.html" target=_blank>某暗黒美夢王</a>ことダークビムマスターさんはこんなものを導入せずともVimの声を聞けてそうですが、まだまだ自分はその域に達していないので、リアルタイム音声合成ライブラリの力を借りることにします。</p> <p>というわけで、Vimにしゃべってもらうためのプラグイン「Shaberu.vim」を公開しました。</p> <p><a href="https://github.com/supermomonga/shaberu.vim">https://github.com/supermomonga/shaberu.vim</a></p> <p>Shaberu.vimは、Vimからリアルタイム音声合成ライブラリを操作するためのラッパープラグインです。</p> <h2 id=toc_1>動作画面</h2> <p>動作画面を載せておきますね。録画ソフトが重いせいで喋りだすまでタイムラグがありますが、実際には命令があればほぼタイムラグなしで喋ってくれます。</p> <p>Macの標準コマンド「say」に付属しているKyokoさんの声です。KyokoさんはiOSに搭載されているエージェントSiriの声でもありますね。 [vim]let g:shaberu_user_define_say_command = &#8216;say -v Kyoko &#8220;%%TEXT%%&#8221;&#8216;[/vim]</p> <p><a href="//open-jtalk.sourceforge.net/" target=_blank>Open JTalk</a>を利用すれば、よりカワイイ感じの声にもできます。カワイー [vim]let g:shaberu_user_define_say_command = &#8216;say-openjtalk &#8220;%%TEXT%%&#8221;&#8216;[/vim]</p> <p><a href="https://gist.github.com/4708420" target=_blank>say-openjtalkコマンドはこんな感じ</a>です。</p> <h2 id=toc_2>インストール方法</h2> <p>NeoBundleとかでいい感じにインストールします。Shaberu.vimはvimprocに依存していますので、vimprocも合わせてインストールします。vimprocは非同期に色々できるやばいやつです。同期的に喋らせると、Vimがしゃべっている間は操作を一切受け付けてくれなくなってしまうので、vimprocを使い非同期に喋らせています。</p> <pre lang=vim>NeoBundle 'Shougo/vimproc', {
  \ 'build' : {
  \   'windows' : 'make -f make_mingw32.mak',
  \   'cygwin' : 'make -f make_cygwin.mak',
  \   'mac' : 'make -f make_mac.mak',
  \   'unix' : 'make -f make_unix.mak',
  \ },
  \ }
NeoBundle 'supermomonga/shaberu.vim'
</pre> <h2 id=toc_3>設定</h2> <p>Mac OS Xであれば標準でsayというコマンドがインストールされているので、特に設定は必要ないです。日本語を喋らせたい場合は、OS Xのスピーチ設定画面からKyokoさんとかの日本語の音声を別途インストールする必要があります。</p> <del> <p> WindowsやLinuxでは、標準のリアルタイム音声合成ライブラリがあるかどうかがわからなかったので、残念ですがデフォルトでは動作しません。Windowsなどで良い感じのライブラリがあれば教えて下さい。 </p> </del> <p>（02/06追記：<a title="Shaberu.vimがWindowsに対応しました" href="/articles/vim/shaberu-vim-support-windows-os.html">Windows対応しました</a>）</p> <p>上記サンプルのように、g:shaberu_user_define_say_commandを定義して任意のコマンドを実行できるようにすることができます。</p> <h2 id=toc_4>しゃべらせる</h2> <p>「:ShaberuSay 喋らせたいテキスト」というコマンドでしゃべります。:ShaberuMuteOnするとミュートになります。出社中とかはおもむろにMuteにしましょう。Mute解除は:ShaberuMuteOffです。:ShaberuMuteToggleでトグルもできます。 g:shaberu_echo_when_muteが1の場合は、Mute時に:ShaberuSayコマンドを実行した際、echoエリアにテキストが表示されます。</p> <h2 id=toc_5>HookやAutocmdでVimとイチャイチャする</h2> <pre lang=vim>" Vim core
autocmd MyAutoCmd VimEnter * ShaberuSay 'ビムにようこそ'
autocmd MyAutoCmd VimLeave * ShaberuSay 'さようなら'

" VimShell
autocmd FileType vimshell
\ call vimshell#hook#add('chpwd' , 'my_vimshell_chpwd' , 'g:my_vimshell_chpwd')
\| call vimshell#hook#add('emptycmd', 'my_vimshell_emptycmd', 'g:my_vimshell_emptycmd')
\| call vimshell#hook#add('notfound', 'my_vimshell_notfound', 'g:my_vimshell_notfound')

function! g:my_vimshell_chpwd(args, context)
  ShaberuSay 'よっこいしょ'
endfunction
function! g:my_vimshell_emptycmd(cmdline, context)
  :ShaberuSay 'コマンドを入力してください'
  return a:cmdline
endfunction
function! g:my_vimshell_notfound(cmdline, context)
  :ShaberuSay 'コマンドが見つかりません'
  return a:cmdline
endfunction
" .vimrc保存時に自動的にsource
autocmd MyAutoCmd BufWritePost .vimrc nested source $MYVIMRC | ShaberuSay 'ビムアールシーを読み込みました'
" 開発用ディレクトリ内.vimファイルに関して、ファイル保存時に自動でsourceする
execute 'autocmd MyAutoCmd BufWritePost,FileWritePost' s:local_bundle_dir . '*.vim' 'source | echo "sourced : " . bufname("%") | ShaberuSay "ソースしました"
</pre> <p>こんなかんじで。TweetVimで新規MentionやDMがあった時に通知したりできれば便利な気がするけど、Hookなかった気がする…</p> <h2 id=toc_6>Vim Advent Calendar 2012 68日目</h2> <p>Vim Advent Calendar 2012 68日目は@scheakurさんです。もうすぐ70日ですか。すごくアドベントな感じですね。</p> </div> <div class=entry-author> <div class=avatar> <img src="/images/kokoro-chan-da2b7132.png"> </div> <div class=profile> <h3> supermomonga </h3> <p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p> <a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a> </div> </div> <div class=entry-meta> <h3> コメント一覧ですよ </h3> <div class=hatena_bookmark_comments data-uri="http://blog.supermomonga.com/articles/vim/shaberu-vim.html"></div> </div> </div> <aside> <h2> タグ一覧ですよ </h2> <ol> <li class="default label"> <i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/java.html">Java</a>(4) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(6) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li> </ol> </aside> </div> <script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-22136268-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script> </body> </html> <div id=fb-root></div> <script src="/javascripts/bookmark_blogparts-b37aab8f.js" async=async defer=defer></script> <script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>