<!DOCTYPE html><html><head><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><title>automatic.vimでウィンドウの一時的分割をハンドリングしよう - かなりすごいブログ</title><link href="/stylesheets/theme-237a2e34.css" rel=stylesheet /><link href="/stylesheets/monokai-16825c43.css" rel=stylesheet /></head><body role=main><header><h1><a href="/">かなりすごいブログ</a></h1></header><div id=main><div class=entry><div class=entry-header><h1> automatic.vimでウィンドウの一時的分割をハンドリングしよう </h1><div class=entry-tags></div><span class=entry-date>2013年08月21日</span></div><div class=entry-share><div class="share hatena"><a onclick="window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=530,width=510');return false;" href="//b.hatena.ne.jp/add?mode=confirm&amp;url=http://blog.supermomonga.com/articles/vim/automatic.html&amp;title=automatic.vimでウィンドウの一時的分割をハンドリングしよう">はてブに追加</a></div><div class="share twitter"><a onclick="window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=230,width=600');return false;" href="//twitter.com/share?text=automatic.vimでウィンドウの一時的分割をハンドリングしよう&amp;url=http://blog.supermomonga.com/articles/vim/automatic.html">この記事をツイート</a></div><div class="share feedly"><a target=_blank href="//cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fblog.supermomonga.com%2Ffeed.xml">Feedlyで購読</a></div></div><div class=entry-body><p><a href="//atnd.org/events/33746">Vim Advent Calendar 2012</a>、264日目の記事になります。</p><p>本日は、<a href="https://github.com/osyo-manga/vim-automatic">automatic.vim</a>というプラグインを使って、Vimにおける「ウィンドウの一時的分割」をハンドリングする方法をお伝えします。</p><h2 id="automatic.vimとは">automatic.vimとは</h2><p>私が「<a href="https://github.com/m2ym/popwin-el">popwin.el</a>」のVim版欲しいなーとつぶやいたらおしょーさんが作ってくれたプラグインです。感謝。</p><p><a href="https://github.com/osyo-manga/vim-automatic">automatic.vim</a>は、ウィンドウの状態変化をフックとして人気の処理を実行するための、薄いライブラリです。ここでいう「ウィンドウ」とは、Vim用語のウィンドウです。例えば、Vimの画面が二分割されている場合、Vimにはウィンドウが2つ存在する状態となります。</p><p>automatic.vim自体の詳しい説明や設定方法については、作者のおしょーさんがブログで解説してくれていますので、記事「<a href="//d.hatena.ne.jp/osyo-manga/20130812/1376314945">Vim で指定したウィンドウに対して任意の設定を行うプラグインをつくった</a>」をご覧ください。</p><p>今回の記事では、automatic.vimを用いて、「ウィンドウの一時的分割」をハンドリングするノウハウをお伝えします。</p><h2 id="ウィンドウの「一時的分割」とは">ウィンドウの「一時的分割」とは</h2><p>この記事における「一時的分割」のウィンドウとは、「何らかの操作のために分割したが、その目的が終わったらすぐ閉じるウィンドウ」を指します。たとえば、以下の様なシーンにおける分割ウィンドウは、一時的分割のウィンドウです。</p><ul><li><code>:Unite file</code>で開き、ファイルを選択してすぐ閉じるUniteの分割ウィンドウ</li><li><code>:VimShellPop -toggle</code>で開き、少し操作をした後再び<code>:VimShellPop -toggle</code>で閉じるVimShellの分割ウィンドウ</li><li><code>q:</code>で開き、コマンド実行後自動で閉じるCmdWinの分割ウィンドウ</li></ul><p>逆に、以下の様なシーンにおける分割は、一時的分割ではありません</p><ul><li><code>:sp</code>もしくは<code>:vsp</code>し画面を分割し、二つのファイルのソースコードを見比べている</li></ul><h2 id="automatic.vimによってできること">automatic.vimによってできること</h2><p>automatic.vimを使用することで、これらの一時的分割ウィンドウの出現位置やサイズなどを、一元化して管理することができます。 また、automatic.vimにはapplyという仕組みがあり、任意の関数をこれらのウィンドウにおいて実行させることができ、これを活用することで一時的ウィンドウに共通したキーバインドや設定を定義することが可能となります。</p><h2 id="一時的ウィンドウハンドリングの設定例">一時的ウィンドウハンドリングの設定例</h2><pre lang=vim>nnoremap &lt;silent> &lt;plug>(quit) :&lt;c -u>q&lt;cr>
function! s:my_temporary_window_init(config, context)
  nmap &lt;buffer> &lt;c -[>  &lt;plug>(quit)
endfunction

let g:automatic_default_match_config = {
      \   'is_open_other_window' : 1,
      \ }
let g:automatic_default_set_config = {
      \   'height' : '60%',
      \   'move' : 'bottom',
      \   'apply' : function('s:my_temporary_window_init')
      \ }
let g:automatic_config = [
      \   { 'match' : { 'buftype' : 'help' } },
      \   { 'match' : { 'bufname' : '^.vimshell' } },
      \   { 'match' : { 'bufname' : '^.unite' } },
      \   {
      \     'match' : {
      \       'filetype' : '\v^ref-.+',
      \       'autocmds' : [ 'FileType' ]
      \     }
      \   },
      \   {
      \     'match' : {
      \       'bufname' : '\[quickrun output\]',
      \     },
      \     'set' : {
      \       'height' : 8,
      \     }
      \   },
      \   {
      \     'match' : {
      \       'autocmds' : [ 'CmdwinEnter' ]
      \     },
      \     'set' : {
      \       'is_close_focus_out' : 1,
      \       'unsettings' : [ 'move', 'resize' ]
      \     },
      \   }
      \ ]

</pre><p><code>g:automatic_default_set_config</code>の<code>height</code>や<code>moge</code>はそのまんま、位置とサイズの指定です。これによって、特に個別指定しない場合に関しては、高さがVim全体の60%、位置が下で分割が行われるようになります。QuickRunウィンドウはもう少し小さめで表示したいので、個別設定で8行分の高さとなるように設定、特殊なウィンドウであるCmdWinは、リサイズや移動ができず、行おうとするとエラーが発生してしまうため、<code>unsettings</code>オプションで<code>move</code>と<code>resize</code>（<code>height</code>および<code>width</code>に該当）のデフォルト設定を無効化しています。</p><p>ここまではautomatic.vimのヘルプにも記載されている一般的な設定なのですが、キモは<code>apply</code>オプションで指定している<code>s:my_temporary_window_init</code>関数になります。</p><p>この関数は、該当バッファ内のみで有効なマッピングとして、「ノーマルモードにおける<code>C-[</code>で<code>:q</code>を実行する」というものを定義するというものです。この関数を適用することで、一時的分割のウィンドウは、どのような状態からでも<code>C-[</code>を連打すれば閉じることができ、分割状態からニュートラルなウィンドウ分割状態へと戻ることが出来る様になります。さながら、Emacsの「とりあえず困ったら<code>C-g</code>連打」の様な操作感です。</p><p>この設定は地味なものの、かなり強力です。私はもうautomatic.vimなしのVimは使えなくなってしまいました。みなさんも、ぜひお試しください。</p><h2 id="おまけ">おまけ</h2><p>なぜわざわざ<code>&lt;Plug&gt;(quit)</code>を定義しているんだ？と思われる方もいると思いますので解説しておきます。</p><p>私は<code>:</code>を<code>q:i</code>にマッピングしており、<code>:</code>を打鍵するとCmdWinが開くような設定をしています。ですので直接<code>nmap &lt;buffer&gt; &lt;C-[&gt; :&lt;C-u&gt;q&lt;CR&gt;</code>といったマッピングを行うと、実際は<code>q:i&lt;C-u&gt;q&lt;CR&gt;</code>と入力した際と同じ様な動作になってしまいます。こういった場合、この様に<plug>マッピングを経由させて本来の<code>:</code>を入力するというテクニックが使えます。</plug></p></div><div class=entry-share><div class="share hatena"><a onclick="window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=530,width=510');return false;" href="//b.hatena.ne.jp/add?mode=confirm&amp;url=http://blog.supermomonga.com/articles/vim/automatic.html&amp;title=automatic.vimでウィンドウの一時的分割をハンドリングしよう">はてブに追加</a></div><div class="share twitter"><a onclick="window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=230,width=600');return false;" href="//twitter.com/share?text=automatic.vimでウィンドウの一時的分割をハンドリングしよう&amp;url=http://blog.supermomonga.com/articles/vim/automatic.html">この記事をツイート</a></div><div class="share feedly"><a target=_blank href="//cloud.feedly.com/#subscription%2Ffeed%2Fhttp%3A%2F%2Fblog.supermomonga.com%2Ffeed.xml">Feedlyで購読</a></div></div><div class=entry-author><div class=avatar><img src="/images/kokoro-chan-da2b7132.png"></div><div class=profile><h3> supermomonga </h3><p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p><a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a></div></div><div class=entry-meta><h3> あわせてよみたい </h3><ul><li><a href="/articles/vim/vim-douzo.html">･▿･)つVim)‾▿◝ ),;&#8217;</a></li><li><a href="/articles/emacs/emacs-and-vi.html">EmacsユーザーがVimを1ヶ月使った感想</a></li><li><a href="/articles/jruby/javafx-rawr.html">RubyでGUIアプリを作るならJRuby+JavaFX+Rawrで決まり！</a></li><li><a href="/articles/vim/neobundle-sugoibenri.html">ももんが流NeoBundle管理術</a></li><li><a href="/articles/vim/taiwa.html">Vimと対話せよ</a></li><li><a href="/articles/vim/vimshell-dynamicprompt.html">VimShellが動的プロンプトに対応しました（やばい）</a></li><li><a href="/articles/vim/jazzradio-vim-released.html">ジャズだって聴ける。そう、Vimならね。</a></li><li><a href="/articles/vim/neobundle-sugoi-setting.html">新・ももんが流NeoBundle管理術（あたらしい）</a></li><li><a href="/articles/りんごまっち/yabai.html">ウェブサービスリリースしたので前代未聞のやばい広告枠売ります</a></li><li><a href="/articles/javascript/hatena-js-peropero.html">実際に読んで分かった、はてなJSのダメなコード</a></li></ul></div></div><aside><h2> タグ一覧ですよ </h2><ul><li class="default label"><i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(6) </li><li class="default label"><i class=icon-tag></i><a href="/tags/java.html">Java</a>(5) </li><li class="default label"><i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li><li class="default label"><i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li><li class="default label"><i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(20) </li><li class="default label"><i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(7) </li><li class="default label"><i class=icon-tag></i><a href="/tags/jruby.html">JRuby</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/javafx.html">JavaFX</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/others.html">Others</a>(3) </li><li class="default label"><i class=icon-tag></i><a href="/tags/elixir.html">Elixir</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/javascript.html">Javascript</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/neta.html">Neta</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/mac-os-x.html">Mac OS X</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/homebrew.html">homebrew</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/rbenv.html">rbenv</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/evil.html">Evil</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/mechanize.html">Mechanize</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/scraping.html">Scraping</a>(1) </li></ul><h2> 聴いてるやつ </h2><ul class=amazon_products><li><a href="//www.amazon.co.jp/gp/product/B000F6YUD2/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000F6YUD2&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000F6YUD2&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000F6YUD2" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B001NJNN42/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B001NJNN42&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B001NJNN42&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B001NJNN42" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000J3FF6C/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000J3FF6C&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000J3FF6C&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000J3FF6C" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B001A35V46/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B001A35V46&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B001A35V46&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B001A35V46" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000VOSU2A/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000VOSU2A&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000VOSU2A&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000VOSU2A" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000NDFJNC/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000NDFJNC&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000NDFJNC&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000NDFJNC" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B0019N1RKY/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B0019N1RKY&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B0019N1RKY&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B0019N1RKY" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000VOONCQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000VOONCQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000VOONCQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000VOONCQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000SKNPIQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000SKNPIQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000SKNPIQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000SKNPIQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B00857EREA/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00857EREA&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00857EREA&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B00857EREA" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B002AEG0RQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B002AEG0RQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B002AEG0RQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B002AEG0RQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B002AEG0S0/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B002AEG0S0&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B002AEG0S0&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B002AEG0S0" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li></ul></aside></div><script>var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-22136268-1"]),_gaq.push(["_setDomainName","supermomonga.com"]),_gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"//ssl":"//www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();</script></body></html><script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  // DISQUS
  var disqus_shortname = 'momonga';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>