<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>VimShellでクラウド上のソースを実行したい - かなりすごいブログ</title><link href="/stylesheets/theme-93d9eda3.css" media=screen rel=stylesheet /> <link href="/stylesheets/monokai-a37e9352.css" media=screen rel=stylesheet /> </head> <body role=main> <header> <h1> <a href="/">かなりすごいブログ</a> </h1> </header> <div id=main> <div class=entry> <div class=entry-header> <h1> VimShellでクラウド上のソースを実行したい </h1> <div class=entry-tags> </div> </div> <div class=entry-share> <div class="share hatena"> <a href="//b.hatena.ne.jp/entry/" class=hatena-bookmark-button data-hatena-bookmark-layout=vertical-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"></a> <script src="//b.st-hatena.com/js/bookmark_button.js" charset=utf-8 async=async></script> </div> <div class="share twitter"> <a href="https://twitter.com/share" class=twitter-share-button data-count=vertical data-via=supermomonga data-lang=ja data-dnt=true>ツイート</a> </div> <div class="share facebook"> <div class=fb-like data-href="https://developers.facebook.com/docs/plugins/" data-layout=box_count data-action=like data-show-faces=false data-share=false></div> </div> <div class="share pocket"> <a data-pocket-label=pocket data-pocket-count=vertical class=pocket-btn data-lang=en></a> </div> </div> <div class=entry-body> <p>こういうGistがあったとします。</p> <p><a href="https://gist.github.com/4349265">https://gist.github.com/4349265</a></p> <p>これのrawテキストは</p> <p><a href="https://gist.github.com/raw/4349265/sudden-vim.py">https://gist.github.com/raw/4349265/sudden-vim.py</a></p> <p>というURLで取得できます。<br> 簡単なPythonスクリプトです。</p> <p>このソースをzshでpythonで実行したい場合、以下の様なコマンドで実行できます。多分bashでも動きます。 [bash]python -c &quot;$(curl -fs <a href="https://gist.github.com/raw/4349265/sudden-vim.py)%22%5B/bash%5D">https://gist.github.com/raw/4349265/sudden-vim.py)&quot;[/bash]</a></p> <p><a href="/articles/vim/put-cloud-source-to-args-in-vimshell.html/attachment/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2012-12-21-7-55-00" rel="attachment wp-att-607"><img class="aligncenter size-full wp-image-607" title="スクリーンショット 2012-12-21 7.55.00" alt="" src="/images/uploads/2012-12-ss-2012-12-21-7.55.00-7d505ab6.png" width=782 height=368 /></a></p> <p>pythonの-cオプションは、引数で渡したテキストをソースコードとして評価し実行してくれます。zshでは$(コマンド)を先に評価し、実行結果を展開してくれるので、この様にcurlと組み合わせることでクラウド上にあるソースコードを実行することができます。</p> <p>Macでおなじみの<a href="//mxcl.github.com/homebrew/">homebrew</a>も、rubyですが同じようなインストール方法をとっています。 [bash]ruby -e &quot;$(curl -fsSkL raw.github.com/mxcl/homebrew/go)&quot;[/bash]</p> <p>で、それをVimShellでもやりたいと思い色々試行錯誤してみました。VimShellのTipsに以下のような記述があります。</p> <blockquote> <p>backquote  *vimshell-tips-backquote*<br> You can use command output as arguments. </p> <blockquote> <p>vimshell% echo `ls`<br> &lt;<br> And embed Vim script expression. </p> <p>vimshell% echo `=3`<br> &lt;</p> </blockquote> </blockquote> <p>つまり、`（バッククォート）で囲んだ部分はコマンドがインラインで実行、そのoutput（標準出力）が展開されるという事でしょう。</p> <p><a href="/articles/vim/put-cloud-source-to-args-in-vimshell.html/attachment/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2012-12-21-8-06-58" rel="attachment wp-att-608"><img class="aligncenter size-full wp-image-608" title="スクリーンショット 2012-12-21 8.06.58" alt="" src="/images/uploads/2012-12-ss-2012-12-21-8.06.58-8faa4b39.png" width=755 height=460 /></a></p> <p>この結果を見るに、仕様としては以下の様な感じかと思われます。</p> <ul> <li> `は&#8221;で囲まなくても良い（echo line1\nline2でなく、echo &#8220;line1\nline2&#8243;の様な動作をする）</li> <li> `をネストして実行することはできない</li> <li> curlもちゃんと動く（ただし&#8221;が消えている）</li> </ul> <p>ここで本題ですが、curlした結果をpythonに渡した結果が以下。</p> <p><a href="/articles/vim/put-cloud-source-to-args-in-vimshell.html/attachment/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2012-12-21-8-12-30" rel="attachment wp-att-609"><img class="aligncenter size-full wp-image-609" title="スクリーンショット 2012-12-21 8.12.30" alt="" src="/images/uploads/2012-12-ss-2012-12-21-8.12.30-94e9cd15.png" width=804 height=340 /></a></p> <p>なぜか、期待した動作をしない。</p> <p><a href="https://gist.github.com/4349482">ダブルクオーテーションを使わないソース版</a>の実行結果は以下の通り。</p> <p><a href="/articles/vim/put-cloud-source-to-args-in-vimshell.html/attachment/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2012-12-21-8-18-48" rel="attachment wp-att-612"><img class="aligncenter size-full wp-image-612" title="スクリーンショット 2012-12-21 8.18.48" alt="" src="/images/uploads/2012-12-ss-2012-12-21-8.18.48-39080ebd.png" width=881 height=385 /></a></p> <p>シングルクォートが2つ消えてる？</p> <p>backquote周りのソースを読んで仕様をもっと把握してから再チャレンジ予定。</p> <p><span style="color: #cc0000;"><strong>2012/12/27追記</strong></span>：パーサの不具合だった様で、vimprocのバージョンアップで意図した動作ができるようになりました。詳細は別記事で上げます。</p> </div> <div class=entry-author> <div class=avatar> <img src="/images/kokoro-chan-da2b7132.png"> </div> <div class=profile> <h3> supermomonga </h3> <p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p> <a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a> </div> </div> <div class=entry-meta> <h3> コメント一覧ですよ </h3> <div class=hatena_bookmark_comments data-uri="http://blog.supermomonga.com/articles/vim/put-cloud-source-to-args-in-vimshell.html"></div> </div> </div> <aside> <h2> タグ一覧ですよ </h2> <ol> <li class="default label"> <i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/java.html">Java</a>(4) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(6) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li> </ol> </aside> </div> <script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-22136268-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script> </body> </html> <div id=fb-root></div> <script src="/javascripts/bookmark_blogparts-b37aab8f.js" async=async defer=defer></script> <script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>