<!DOCTYPE html><html><head><meta charset=utf-8><meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible><title>プロジェクトのハンドリングを効率化するプラグイン、ProjectLocal.vimをリリースしました。 - かなりすごいブログ</title><link href="/stylesheets/theme-7b9c68bf.css" media=screen rel=stylesheet /><link href="/stylesheets/monokai-16825c43.css" media=screen rel=stylesheet /></head><body role=main><header><h1><a href="/">かなりすごいブログ</a></h1></header><div id=main><div class=entry><div class=entry-header><h1> プロジェクトのハンドリングを効率化するプラグイン、ProjectLocal.vimをリリースしました。 </h1><div class=entry-tags><li class="default label"><i class=icon-tag></i><a href="/tags/vim.html">Vim</a></li></div><span class=entry-date>2014年02月05日</span></div><div class=entry-share><div class="share hatena"><a href="//b.hatena.ne.jp/entry/" class=hatena-bookmark-button data-hatena-bookmark-layout=vertical-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"></a></div><div class="share twitter"><a href="https://twitter.com/share" class=twitter-share-button data-count=vertical data-via=supermomonga data-lang=ja data-dnt=true>ツイート</a></div><div class="share facebook"><div class=fb-like data-layout=box_count data-action=like data-show-faces=false data-share=false></div></div><div class="share pocket"><a data-pocket-label=pocket data-pocket-count=vertical class=pocket-btn data-lang=en></a></div></div><div class=entry-body><p><a href="//atnd.org/events/45072">Vim Advent Calendar 2013</a>、66日目の記事になります。</p><h2 id=toc_0>ProjectLocal.vimをリリースしました</h2><p>プロジェクトのハンドリングを効率化する薄い機能を提供するプラグイン、ProjectLocal.vimをリリースしましたのでご紹介します。</p><p><a href="https://github.com/supermomonga/projectlocal.vim">https://github.com/supermomonga/projectlocal.vim</a></p><h2 id=toc_1>ProjectLocal.vimの機能</h2><p>プロジェクトのルートディレクトリに<code>Projectfile</code>という名前のファイルを配置すると、そのディレクトリは1つのプロジェクトとして扱われるようになり、ディレクトリ以下のファイルを開いた時に以下の2つの機能が発動します。</p><h3 id=toc_2>1. プロジェクトルートディレクトリの設定</h3><p>ProjectLocal.vimは、現在開いているファイルのプロジェクトのルートディレクトリを、ファイル（バッファ）のローカル変数に自動でセットします。これにより、プロジェクト内のどのファイルを開いた時も、常にバッファがプロジェクトルートの位置を知ることができます。具体的には、<code>b:projectlocal_root_dir</code>というバッファローカル変数にパスがセットされます。</p><h3 id=toc_3>2. プロジェクト用filetypeの自動設定</h3><p>プロジェクト内のファイルを開いた時、そのファイルのfiletypeに、予め設定したfiletypeを付加することができます。たとえば、<code>.rb</code>ファイルを開いた時、通常は<code>ruby</code>というfiletypeが設定されますが、自動で<code>rails</code>というfiletypeが付加されるように設定することが可能になります。ちなみに、Vimにおいて1つのバッファに複数のfiletypeを割り当てたい時は、それらを<code>.</code>（ドット記号）で連結します。この場合は<code>ruby.rails</code>になるわけですね。</p><p>この設定はプロジェクト毎に変えることができます。方法は簡単で、<code>Projectfile</code>の中に、設定したいfiletypeをカンマ区切りもしくは改行区切りで記載するだけです。</p><h2 id=toc_4>ProjectLocal.vimの利用例</h2><p>ProjectLocal.vimは、それ単体では利便性に直接影響することはない、薄い機能を持った低レイヤプラグインです。ここでは、ProjectLocalの便利な利用例をご紹介します。</p><h3 id=toc_5>プロジェクト内のファイルのみ検索するUniteコマンドを呼び出す</h3><p>特定のプロジェクトに関するプログラミングを行っている時、そのプロジェクトに関係するファイルのみを対象に検索したいことがあると思います。そのような場合、gitなどのVCSで管理されているディレクトリはUnite.vimの標準機能で検索を行うことができますが、すべてのプロジェクトが必ずしもVCSで管理されているとは限りませんし、プロジェクト内でも更に細かくスコープを分けたいなどの要望があると思います。</p><p>そういった場合、ProjectLocal.vimにて任意の場所に<code>Projectfile</code>を配置することで、簡単にプロジェクト、もしくはプロジェクトの一部のファイルを検索することができるようになります。</p><h4 id=toc_6>.vimrc</h4><pre class="highlight viml">nnoremap <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">&lt;</span>Space<span class="p">&gt;</span><span class="k">p</span>  <span class="p">:&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span><span class="k">call</span> Unite_project_files<span class="p">(</span><span class="s1">'-start-insert'</span><span class="p">)&lt;</span>CR<span class="p">&gt;</span>
<span class="k">function</span><span class="p">!</span> Unite_project_files<span class="p">(</span><span class="k">options</span><span class="p">)</span>
  <span class="k">if</span> exists<span class="p">(</span><span class="s1">'b:projectlocal_root_dir'</span><span class="p">)</span>
    execute <span class="s1">':Unite file_rec/async:'</span> <span class="p">.</span> <span class="nv">b:projectlocal_root_dir</span> <span class="p">.</span> <span class="s1">' '</span> <span class="p">.</span> <span class="nv">a:options</span>
  <span class="k">else</span>
    echo <span class="s2">"You are not in any project."</span>
  <span class="k">endif</span>
<span class="k">endfunction</span>
</pre><p>Unite.vimのfire<em>rec/asyncというソースは、引数として検索対象のディレクトリを取ることができます。これを利用して、`b:projectlocal</em>root_dir`が存在する場合はその値を引数として渡す関数を実装し、キーバインドに割り当てています。</p><h3 id=toc_7>プロジェクト毎に最適なUniteコマンドを呼び出す</h3><p>同じキーバインドでも、状況によって最適な内容を実行してくれたら素敵です。ここでは、Unite.vimを例に、普段はディスク全体を対象にファイルを列挙するが、railsプロジェクトを開いている時には<code>unite-rails</code>というRails用のUnite sourceを呼び出すといった設定を行ってみます。</p><h4 id=toc_8>Projectfile</h4><pre class="highlight plaintext">rails
</pre><h4 id=toc_9>.vimrc</h4><pre class="highlight viml">nnoremap <span class="p">&lt;</span><span class="k">silent</span><span class="p">&gt;</span> <span class="p">&lt;</span>Space<span class="p">&gt;</span><span class="k">j</span>  <span class="p">:&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite file_mru<span class="p">&lt;</span>CR<span class="p">&gt;</span>

<span class="k">function</span><span class="p">!</span> <span class="nv">s:unite_rails_init</span><span class="p">()</span>
  nnoremap <span class="p">&lt;</span>buffer<span class="p">&gt;</span> <span class="p">&lt;</span>Space<span class="p">&gt;</span><span class="k">j</span>  <span class="p">:&lt;</span>C<span class="p">-</span><span class="k">u</span><span class="p">&gt;</span>Unite rails<span class="sr">/model rails/</span>controller rails<span class="sr">/view rails/</span>db rails<span class="sr">/config rails/</span>javascript rails<span class="sr">/stylesheet rails/</span>helper rails/mailer<span class="p">&lt;</span>CR<span class="p">&gt;</span>
<span class="k">endfunction</span>

aug MyAutoCmd
  <span class="k">au</span> <span class="nb">FileType</span> *rails* <span class="k">call</span> <span class="nv">s:unite_rails_init</span><span class="p">()</span>
aug END
</pre><p>このように、<code>&lt;Space&gt;j</code>というキーバインドに対して、普段は<code>file_mru</code>ソースを呼び出すものの、railsのプロジェクトでは<code>unite-rails</code>のソースを呼び出すといった設定を完結に記載することができました。AutoCmdのパターンは完全一致なので、<code>*</code>で囲むことで<code>ruby.rails</code>などといったfiletypeにもマッチする様な工夫を行っています。</p><h2 id=toc_10>まとめ</h2><p>ProjectLocal.vimを利用することで、現在どのプロジェクトのファイルを開いているのか、プロジェクトの種類はなんなのか、プロジェクトのルートディレクトリはどこなのか、といった情報が提供されるようになり、プロジェクトに依存する固有の設定が格段に行い易くなりました。小さい実装ながらも強力なプラグインですので、皆さんもぜひお試し頂ければと思います。</p></div><div class=entry-author><div class=avatar><img src="/images/kokoro-chan-da2b7132.png"></div><div class=profile><h3> supermomonga </h3><p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p><a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a></div></div><div class=entry-meta><div id=disqus_thread></div><noscript>Please enable JavaScript to view the<a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a><a href="//disqus.com" class=dsq-brlink>comments powered by<span class=logo-disqus>Disqus</span></a></noscript></div></div><div id=fb-root></div><script src="//b.st-hatena.com/js/bookmark_button.js" charset=utf-8 async=async defer=defer></script><aside><h2> タグ一覧ですよ </h2><ul><li class="default label"><i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(5) </li><li class="default label"><i class=icon-tag></i><a href="/tags/java.html">Java</a>(5) </li><li class="default label"><i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li><li class="default label"><i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li><li class="default label"><i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(13) </li><li class="default label"><i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(4) </li><li class="default label"><i class=icon-tag></i><a href="/tags/jruby.html">JRuby</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/javafx.html">JavaFX</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/others.html">others</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/elixir.html">Elixir</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/javascript.html">Javascript</a>(1) </li><li class="default label"><i class=icon-tag></i><a href="/tags/neta.html">Neta</a>(1) </li></ul><h2> 聴いてるやつ </h2><ul class=amazon_products><li><a href="//www.amazon.co.jp/gp/product/B000F6YUD2/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000F6YUD2&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000F6YUD2&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000F6YUD2" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B001NJNN42/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B001NJNN42&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B001NJNN42&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B001NJNN42" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000J3FF6C/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000J3FF6C&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000J3FF6C&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000J3FF6C" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B001A35V46/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B001A35V46&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B001A35V46&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B001A35V46" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000VOSU2A/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000VOSU2A&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000VOSU2A&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000VOSU2A" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000NDFJNC/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000NDFJNC&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000NDFJNC&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000NDFJNC" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B0019N1RKY/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B0019N1RKY&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B0019N1RKY&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B0019N1RKY" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000VOONCQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000VOONCQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000VOONCQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000VOONCQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B000SKNPIQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B000SKNPIQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B000SKNPIQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B000SKNPIQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B00857EREA/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B00857EREA&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B00857EREA&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B00857EREA" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B002AEG0RQ/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B002AEG0RQ&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B002AEG0RQ&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B002AEG0RQ" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li><li><a href="//www.amazon.co.jp/gp/product/B002AEG0S0/ref=as_li_qf_sp_asin_il?ie=UTF8&camp=247&creative=1211&creativeASIN=B002AEG0S0&linkCode=as2&tag=supermomonga-22"><img src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&ASIN=B002AEG0S0&Format=_SL110_&ID=AsinImage&MarketPlace=JP&ServiceVersion=20070822&WS=1&tag=supermomonga-22"></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=supermomonga-22&l=as2&o=9&a=B002AEG0S0" width=1 height=1 border=0 alt="" style="border:none !important; margin:0px !important;"></li></ul></aside></div><script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-22136268-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script></body></html><script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
  // DISQUS
  var disqus_shortname = 'momonga';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>