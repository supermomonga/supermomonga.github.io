<!DOCTYPE html> <html> <head> <meta charset=utf-8> <meta content="IE=edge,chrome=1" http-equiv=X-UA-Compatible> <title>Vimによる通知センター実装、ThingsPast.vimをリリースしました - かなりすごいブログ</title><link href="/stylesheets/theme-93d9eda3.css" media=screen rel=stylesheet /> <link href="/stylesheets/monokai-a37e9352.css" media=screen rel=stylesheet /> </head> <body role=main> <header> <h1> <a href="/">かなりすごいブログ</a> </h1> </header> <div id=main><div class=entry> <div class=entry-header> <h1> Vimによる通知センター実装、ThingsPast.vimをリリースしました </h1> <div class=entry-tags> <li class="default label"> <i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a> </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a> </li> </div> </div> <div class=entry-share> <div class="share hatena"> <a href="//b.hatena.ne.jp/entry/" class=hatena-bookmark-button data-hatena-bookmark-layout=vertical-balloon data-hatena-bookmark-lang=ja title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width=20 height=20 style="border: none;"></a> <script src="//b.st-hatena.com/js/bookmark_button.js" charset=utf-8 async=async></script> </div> <div class="share twitter"> <a href="https://twitter.com/share" class=twitter-share-button data-count=vertical data-via=supermomonga data-lang=ja data-dnt=true>ツイート</a> </div> <div class="share facebook"> <div class=fb-like data-href="https://developers.facebook.com/docs/plugins/" data-layout=box_count data-action=like data-show-faces=false data-share=false></div> </div> <div class="share pocket"> <a data-pocket-label=pocket data-pocket-count=vertical class=pocket-btn data-lang=en></a> </div> </div> <div class=entry-body><p><a href="//atnd.org/events/45072">Vim Advent Calendar 2013</a>、5日目の記事になります。プラグインの完成が遅れ、遅刻力を発揮してしまいました…。</p> <h2 id=toc_0>ThingsPast.vimをリリースしました</h2> <p>ThingsPast.vimというプラグインをリリースしました。 これは、Mac OS Xの通知センターのようなものをVim内で実装したものです。</p> <p><a href="https://github.com/supermomonga/thingspast.vim">https://github.com/supermomonga/thingspast.vim</a></p> <p>Macをお持ちでない方のために簡単に説明すると、通知センターは各アプリケーションによるユーザーへの「通知」をハンドリングする機能です。Twitterの新着リプライや新着受信メールなどといった通知の一覧表示や、通知一覧からの選択によってアプリケーションを適切な状態で起動、たとえば通知された新着メールをクリックするとそのメールが選択された状態でメーラーを起動するなど、を行うことができます。</p> <p><img src="/images/uploads/2013-12-notifcenter-0b9d4c8a.png" alt=notifcenter width=314 height=350 class="aligncenter size-full wp-image-978"/></p> <p>ThingsPast.vimは、これをVim内で再実装したものです。</p> <h2 id=toc_1>ThingsPast.vimのメリット</h2> <p>Vimで動作するTwitterクライアントやメーラー、Lingrクライアントなど、Vimをプラットフォームとして動作するアプリケーションがあります。これらの新着通知をハンドリングする手段としては、今までGrowlなどのOSレベルの通知アプリケーションと連携して通知を行われるのが一般的でした。</p> <p>ですが、この方法には欠点があります。それは、OSから見て、通知元のアプリケーションは単にVimでしかなく、Vimで動作しているどのアプリケーションからの通知であるのかといった情報のハンドリングが難しいことです。</p> <p>たとえば、TweetVimというVimで動作するTwitterクライアントがありますが、TweetVimからの「新着リプライ」通知をMac OS Xの通知センターに表示すること自体は可能なものの、それを通知一覧から選択した際にVimを起動し、その中でTweetVimを起動し、該当のリプライや会話を表示する、といった動作を行わせることはかなり難しいのです。</p> <p>ThingsPast.vimは、Vim内に独立した通知管理システムを構築することで、こういった問題を解決しました。</p> <h2 id=toc_2>ThingsPast.vimの動作風景</h2> <p><img src="/images/uploads/2013-12-Screen-Shot-2013-12-06-at-01.05.07-7c69f176.png" alt="Screen Shot 2013-12-06 at 01.05.07" width=784 height=560 class="aligncenter size-full wp-image-979"/></p> <p>ThingsPast.vimをインストールし、<code>&lt;Space&gt;n</code>を打鍵すると、Vimのウィンドウが縦に分割され、右側にプラグインごとの通知一覧が表示されます。<code>j</code>,<code>k</code>で通知を選択でき、選択した状態で<code>&lt;CR&gt;</code>（Enter）を打鍵すると、プラグインごとに最適な処理が実行され、その後通知一覧から通知は消えます。</p> <h2 id=toc_3>ThingsPast.vimの想定利用シーン</h2> <p>ThingsPast.vimの想定している利用シーンとして、以下の様なものがあります。</p> <ul> <li> <a href="https://github.com/basyura/TweetVim">TweetVim</a>（Twitterクライアント） <ul> <li> 新着リプライ通知</li> <li> 新着DM通知</li> </ul></li> <li> <a href="https://github.com/basyura/J6uil.vim">J6uil.vim</a>（Lingrクライアント） <ul> <li> 新着メッセージ通知</li> </ul></li> <li> <a href="https://github.com/yuratomo/gmail.vim">Gmail.vim</a>（Gmailクライアント） <ul> <li> 新着メール通知</li> </ul></li> <li> <a href="https://github.com/Shougo/vimshell.vim">VimShell.vim</a>（ターミナルエミュレータ） <ul> <li> 時間がかかった処理が終了した際、VimShellがアクティブバッファでない場合、通知をする</li> </ul></li> </ul> <p>ThingsPast.vimで通知を受け取るには、それぞれのプラグインからThingsPast.vimが提供しているAPI関数をコールする必要があります。ですので、hookの仕組みが実装されているプラグインとの連携を、vimrcの設定で記述することができます。この辺りについて、詳しくはヘルプドキュメントの方をご覧ください。</p> <p>実際には、上記のプラグインにはhook機能が不足しておりThingsPast.vimとの連携ができないものが多いのが現状です。</p> <p>ThingsPast.vimが一応のリリースに漕ぎ着けましたので、それらプラグインにhook機能を実装しPull Requestを送りたいなと考えています。</p> <h2 id=toc_4>今後の実装予定と課題</h2> <ul> <li> 設定例の充実化 <ul> <li> そのためにはまず、Hook追加のPull Requestを送りまくることになりそうです</li> </ul></li> <li> シンタックスハイライトの実装 <ul> <li> もっと見栄えをかっこよくしたいです</li> </ul></li> <li> アニメーションの自走 <ul> <li> 選択中の通知は、省略されたメッセージが右から左に流れて全文を読めるようにしたいです</li> </ul></li> <li> Hookの実装 <ul> <li> これにより、通知が追加された際に<a href="https://github.com/supermomonga/shaberu.vim">Shaberu.vim</a>で音声通知を行う、といったことができるようになります</li> </ul></li> <li> 新着通知が追加されたプラグインを上に表示する用に、並び順を改善</li> <li> ステータスラインに通知数を表示することなどができるように、外部からの利用を想定した便利関数の実装</li> <li> コードのリファクタリング <ul> <li> VimAdventCalendarに間に合わせるために、所々に妥協した面が見えます…</li> </ul></li> <li> ユニットテストの充実化</li> </ul> <p>12月7日に開催されるTokyoVimでは、ThingsPast.vimのリファクタリングや機能追加など、重点的に行いたいと思います。</p> <h2 id=toc_5>謝辞</h2> <p>ThingsPast.vimは私にとって初めての独自バッファを作成するプラグインであり、Vim scriptプログラミングの経験が浅い私にとって、かなり手探りでの実装となりました。プラグインを作成するにあたってLingrのVim部屋にて多数の方から様々なアドバイスを頂戴し、なんとか完成に至ったという次第です。 アドバイスをくださった皆さまに、この場を借りてお礼申し上げます。</p> <h2 id=toc_6>Vim Advent Calendar 2013 6日目は</h2> <p>明日、というか今日ですが、の担当は@kaoriyaさんです。よろしくお願いします！</p> </div> <div class=entry-author> <div class=avatar> <img src="/images/kokoro-chan-da2b7132.png"> </div> <div class=profile> <h3> supermomonga </h3> <p> かなりすごいことでゆうめい。したまちでしらぬものはいない。 </p> <a href="https://twitter.com/supermomonga" class=twitter-follow-button data-show-count=false data-lang=ja data-size=large data-dnt=true>@supermomongaさんをフォロー</a> </div> </div> <div class=entry-meta> <h3> コメント一覧ですよ </h3> <div class=hatena_bookmark_comments data-uri="http://blog.supermomonga.com/articles/vim/thingspast-vim-released.html"></div> </div> </div> <aside> <h2> タグ一覧ですよ </h2> <ol> <li class="default label"> <i class=icon-tag></i><a href="/tags/emacs.html">Emacs</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/java.html">Java</a>(4) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/jdee.html">JDEE</a>(5) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/swt.html">SWT</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/svn.html">svn</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ubuntu.html">Ubuntu</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/facebook.html">facebook</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/windows.html">Windows</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/mac.html">Mac</a>(2) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/fx.html">FX</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/metatrader4.html">MetaTrader4</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/vim.html">Vim</a>(6) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/lingr.html">Lingr</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/neobundle.html">NeoBundle</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/minecraft.html">Minecraft</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/ruby.html">Ruby</a>(1) </li> <li class="default label"> <i class=icon-tag></i><a href="/tags/thingspast.html">ThingsPast</a>(1) </li> </ol> </aside> </div> <script>
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-22136268-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script> </body> </html> <div id=fb-root></div> <script src="/javascripts/bookmark_blogparts-b37aab8f.js" async=async defer=defer></script> <script>
  // twitter share button
  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
  // pocket save button
  !function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");
  // Facebook like button
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1&appId=184200125074087";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>